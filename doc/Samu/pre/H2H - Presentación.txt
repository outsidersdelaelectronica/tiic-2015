{Apertura}
Muchas gracias a todos por venir. [Voy a realizar la presentación de mi Proyecto Fin de Carrera titulado "Diseño e implementación de una plataforma hardware para un sistema de acceso inalámbrico a dispositivos médicos mediante Heart-To-Heart"].

{Esquema}
Voy a comenzar la presentación realizando una breve introducción del proyecto y comentando los objetivos principales del mismo. Este proyecto ha sido realizado en conjunto con el Proyecto Fin de Carrera "Diseño e implementación de un servicio de acceso inalámbrico a dispositivos médicos mediante Heart-to-Heart" realizado por Tomás Valencia Noheda, por lo que comentaré también los objetivos globales de ambos proyectos. Explicaré de forma esquemática la arquitectura del sistema y el desarrollo de sus tres versiones, así como el desarrollo de la capa de abstracción hardware de la última versión. A continuación mostraré los prototipos fabricados de la última versión y realizaré una demostración de su funcionamiento. Por último, expondré las conclusiones y una serie de posibles líneas futuras del proyecto.

{Introducción y objetivos}
Los avances médicos están haciendo posible el desarrollo de una gran variedad de dispositivos médicos implantables.

Estos deben ser configurados de forma no invasiva e inalámbrica mediante otros dispositivos externos. Esta necesidad conlleva un gran inconveniente: si no se toman medidas de precaución, su manipulación maliciosa puede provocar daños al paciente. Existe por tanto una disyuntiva entre dos requisitos esenciales de un dispositivo médico implantable: por un lado, debe ofrecer políticas de acceso permisivas durante situaciones de emergencia médica. Por el otro, deben ser lo suficientemente estrictos para evitar accesos no autorizados.

Una de las soluciones que existen es el uso de políticas de acceso Heart-to-Heart. Ésta permite acceder al dispositivo médico implantable si y sólo si éste tiene contacto físico directo con el paciente. El protocolo se basa en la adquisición de una variable fisiológica. En el caso de un marcapasos, éste realiza una medida del electrocardiograma del paciente. Al mismo tiempo, el dispositivo de acceso toma su propia medida. Si ambas son lo suficientemente parecidas, el dispositivo de acceso puede acceder al marcapasos.
Este esquema intenta seguir una regla de sentido común: la posibilidad de tener acceso físico a una persona implica la posibilidad de hacerle daño o curarle.

El objetivo de este proyecto es desarrollar una plataforma hardware para implementar servicios de acceso Heart-to-Heart. Esta incluye el prototipo de un dispositivo que haga las veces de marcapasos, un disposivo de acceso, una fuente de alimentación para recargar sus baterías y una capa de abstracción hardware para facilitar el acceso a los recursos de la plataforma.

Los objetivos globales de los dos proyectos se resumen en la realización de dicha plataforma, y en el desarrollo del software que implementa el servicio de acceso a dispositivos médicos mediante Heart-to-Heart.

{Arquitectura}
Tanto el dispositivo de acceso como el marcapasos realizan las mismas funciones: extraen datos del paciente, establecen conexiones inalámbricas, necesitan energía para funcionar y muestran información al operador.

Por ello, se ha desarrollado una única plataforma hardware para ambos dispositivos. Ésta se divide en cinco módulos:
Un front-end analógico, que hace de interfaz con el paciente y extrae su electrocardiograma para calcular la frecuencia cardíaca.
Una interfaz radio compuesta por un transceptor Bluetooth y su antena, para que el dispositivo de acceso pueda conectarse al marcapasos.
Un módulo de alimentación, que incluye una batería LiPo junto con un medidor de batería y un circuito cargador, así como una serie de reguladores de tensión.
Un microcontrolador, que realiza los cálculos necesarios y gestiona el comportamiento de todos los periféricos.
Y, por último, una interfaz de usuario, que cuenta con un indicador acústico, un LED y un pulsador de encendido y apagado. En el caso del dispositivo de acceso, incluye además una pantalla LCD con panel táctil.

{Desarrollo de la plataforma hardware}
A lo largo del proyecto se han realizado tres versiones de la plataforma hardware.

En la primera versión se realizó la primera aproximación a los requisitos de la plataforma. Este diseño implementa todos los módulos de la arquitectura necesarios, pero presenta varios problemas como la falta de memoria RAM para alojar la pila de protocolos de Bluetooth o la carencia de un periférico dedicado para comunicarse con la interfaz paralelo de la pantalla LCD.
La segunda versión, denominada "Persimmon", corrige estos problemas con un microcontrolador diferente con suficiente memoria volátil, un puerto paralelo dedicado y mayor velocidad de procesamiento. También incluye un nuevo front-end analógico que permite realizar electrocardiogramas de hasta seis derivaciones y un conector para una pantalla LCD más grande.
La última versión, evolución del anterior "Persimmon", corrige algunos fallos en la etapa de entrada del front-end analógico e incluye los conectores para los cables de los electrodos en la misma placa.

Esta última versión de la plataforma, "Persimmon 1.1", cuenta con un microcontrolador STM32L162VD de ST Microelectronics. Este cuenta con una CPU ARM Cortex-M3 y todos los periféricos necesarios para conectarse a los periféricos de la placa. Dispone de varios modos de bajo consumo con los que se ha implementado el apagado y encendido por software del sistema. 
El front-end analógico se basa en el ADS1292 de Texas Instruments, que integra un ADC sigma-delta de 24 bits y dos amplificadores de instrumentación específicos para la adquisición de biopotenciales. Incluye también resistencias de protección para limitar la corriente que circula por el cuerpo del paciente y tubos de descarga y diodos Zener para proteger al circuito de la posible descarga de un desfibrilador.
La interfaz radio está compuesta por un transceptor de Bluetooth Classic CC2560B de Texas Instruments y una antena a 2.45 GHz impresa en la PCB.
El módulo de alimentación incluye un medidor de batería BQ27441 y un cargador de baterías LiPo BQ24090 de Texas Instruments, así como un conjunto de reguladores lineales de tensión activables por software desde el microcontrolador para cada módulo de la plataforma.

La interfaz de usuario incluye un indicador acústico controlado por PWM, un LED RGB y un pulsador conectado al microcontrolador que activa y desactiva el encendido y apagado por software. En el caso del dispositivo de acceso, la plataforma se conecta a una pantalla LCD de cinco pulgadas que cuenta con un controlador de display SSD1963 y un controlador de panel táctil resistivo XPT2046.

De la misma forma, se han realizado tres versiones de la fuente de alimentación para recargar la batería de los dos dispositivos. Las tres se basan en una fuente conmutada aislada de tipo Flyback, de 5 voltios y 4 watios de salida. Su diseño es compatible con tensiones de entrada de red eléctrica de 110 o 220 V.

La última versión de la fuente, denominada "Kiwi 1.1", cuenta con un controlador UCC28910 de Texas Instruments con transistor integrado para realizar la conmutación. Este circuito utiliza una técnica de regulación en primario que controla la tensión de salida a través de un devanado auxiliar del transformador. Para conectar la fuente a la red eléctrica se utiliza un cable estándar IEC C7 al conector C8 de la placa, y para conectarla a los dispositivos se utiliza un jack cilíndrico. Se ha evitado utilizar conectores USB para evitar el uso de fuentes potencialmente inseguras. En esta placa se han seguido una serie de directrices de seguridad en cuanto a las distancias mínimas entre el primario y el secundario y el aislamiento del transformador.

{Desarrollo de la capa de abstracción}
Una vez desarrollada la plataforma hardware, se ha implementado una capa de abstracción de los recursos del sistema.

Esta se apoya sobre la HAL de ST Microelectronics, una capa de código que simplifica el uso de los periféricos y la configuración del microcontrolador. Sobre ella se han desarrollado piezas de código que controlan cada uno de los módulos del sistema: front-end analógico, interfaz radio, módulo de alimentación e interfaz de usuario.

El módulo del front-end gestiona la comunicación con el circuito de adquisición de electrocardiogramas. Con él se controlan la configuración y el uso del periférico SPI, que utiliza uno de sus controladores de DMA para almacenar los datos recibidos en memoria. El código contiene también funciones de inicialización y de configuración del circuito integrado.

El módulo de la interfaz radio gestiona el uso de una de las UART del microcontrolador que se comunica con el transceptor.

El módulo de alimentación se subdivide en tres:
El del medidor de batería, que gestiona la configuración y el uso del periférico I2C y el controlador DMA. Contiene también funciones de inicialización y de configuración.
El de los reguladores de tensión, que activan y desactivan las diferentes partes del circuito para reducir el consumo.
Y el del cargador, que responde a las líneas de interrupción que avisan de la presencia de una fuente de alimentación externa.

Por último, el módulo de la interfaz de usuario se subdivide en cinco:
El del indicador acústico, que gestiona la configuración y la activación de dos PWM del microcontrolador, que controlan la frecuencia y la duración del sonido.
El del LED RGB, que simplemente activa y desactiva la luz mediante líneas de propósito general.
El del pulsador de encendido y apagado, que activa la línea de wakeup del microcontrolador para implementar el encendido y apagado por software.

Y en el caso del dispositivo de acceso:
El del panel táctil, que gestiona la recepción de los datos de posición de la pantalla a través de un periférico SPI.
Y el de la pantalla LCD, que gestiona la configuración y el uso del puerto paralelo del microcontrolador y un controlador de DMA. Incluye también funciones de inicialización, configuración y funciones para dibujar gráficos por pantalla.

{Prototipos}
Terminadas las placas de la plataforma y la fuente de alimentación, se han fabricado varios prototipos.

Se han diseñado carcasas de plástico tanto para el dispositivo de acceso como para el marcapasos, así como para la fuente de alimentación.

Por último, se ha montado un kit con los prototipos diseñados, que se compone de un marcapasos, un dispositivo de acceso, una fuente de alimentación con su cable de red eléctrica, ocho cables y un pack de electrodos. Este kit constituye un sistema completo en el que se pueden implementar servicios de acceso a dispositivos médicos implantables mediante Heart-to-Heart.

{Demostración}
A continuación haré una demostración...

{Conclusiones}
Llegados a este punto, se pueden extraer una serie de conclusiones acerca del proyecto.

Se ha diseñado y fabricado un prototipo funcional tanto del simulador de marcapasos como del dispositivo de acceso, cuyos módulos de adquisición de datos, interfaz radio, módulo de alimentación e interfaz de usuario funcionan correctamente. De la misma forma, se ha diseñado y fabricado un prototipo de una fuente de alimentación para la plataforma, teniendo en cuenta ciertas restricciones de seguridad eléctrica. Por último, se ha desarrollado una capa de abstracción hardware para facilitar el acceso a los recursos de la plataforma al programador de los servicios y aplicaciones.

{Líneas futuras}
Quedan abiertas una serie de posibles líneas de trabajo para mejorar determinados aspectos del proyecto.

Se propone por ejemplo actualizar el microcontrolador actual a otro microcontrolador con unidad de coma flotante y mayor velocidad de procesamiento que cuente con los mismos periféricos. De esta forma se podrían implementar algoritmos más complejos para desarrollar nuevas aplicaciones, por ejemplo, de ayuda al diagnóstico o de detección automática de anomalías en el electrocardiograma. En concreto, se propone el STM32L486VG de ST Microelectronics, que satisface estos requisitos y es compatible pin a pin con el microcontrolador actual, por lo que puede ser sustituído en la PCB sin realizar ninguna modificación.
Se propone también mejorar la interfaz gráfica del dispositivo de acceso, añadiendo incluso memoria volátil adicional para disponer de un frame buffer en el que generar y almacenar gráficos para enviarlos posteriormente a la pantalla.
Existe también la opción de añadir almacenamiento extraíble para almacenar información de la ECG del paciente durante periodos largos de tiempo, con el objetivo de procesar la información a posteriori para realizar diagnósticos o evaluaciones del individuo.
Por último, sería interesante realizar pruebas para comprobar que se cumplen los requisitos de seguridad determinados por los estándares correspondientes en los circuitos de adquisición del electrocardiograma y en la fuente de alimentación.

{Preguntas}
Aquí concluyo mi presentación. Gracias por escucharme y si tienen alguna pregunta estoy aquí para contestarles.